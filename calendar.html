<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ìŠ¤ë§ˆíŠ¸ ê·¼íƒœ ë‹¬ë ¥</title>
    <style>
        body { font-family: -apple-system, sans-serif; padding: 10px; background: #f0f2f5; margin: 0; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 15px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        
        .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .calendar-header h2 { margin: 0; color: #333; font-size: 22px; font-weight: 800; }
        .btn-month { background: none; border: 1px solid #ddd; padding: 5px 12px; border-radius: 5px; cursor: pointer; font-size: 18px; color: #555; }
        
        .calendar-grid { display: grid; grid-template-columns: 25px repeat(7, 1fr); gap: 0; border-top: 1px solid #eee; border-left: 1px solid #eee; }
        
        .header-cell { background: #f8f9fa; padding: 8px 0; font-size: 13px; font-weight: bold; border-right: 1px solid #eee; border-bottom: 1px solid #eee; color: #333; text-align: center;}
        .header-cell.sun { color: #e74c3c; } 
        .header-cell.sat { color: #2980b9; } 

        .week-label { display: flex; align-items: center; justify-content: center; font-size: 10px; color: #bbb; background: #fdfdfd; border-right: 1px solid #eee; border-bottom: 1px solid #eee; writing-mode: vertical-lr; transform: rotate(180deg); }

        .day-cell { 
            min-height: 100px; 
            border-right: 1px solid #eee; 
            border-bottom: 1px solid #eee; 
            padding: 0; 
            padding-bottom: 5px;
            font-size: 13px; 
            position: relative; 
            background: #fff; 
            display: flex; 
            flex-direction: column; 
            gap: 1px; 
        }
        
        .day-cell.sat { background-color: #fafbfd; } 
        .day-cell.sat .day-num { color: #2980b9; }    
        
        .day-cell.holiday-bg { background-color: #fdfafa !important; } 
        .day-cell.holiday-bg .day-num { color: #e74c3c !important; }

        /* â˜…â˜…â˜… [ìˆ˜ì •] ì˜¤ëŠ˜ ë‚ ì§œ ìŠ¤íƒ€ì¼ (ê¹¨ì§ ë°©ì§€) â˜…â˜…â˜… */
        .day-cell.today { 
            background-color: #fff !important; 
            /* border ëŒ€ì‹  ë‚´ë¶€ ê·¸ë¦¼ì ì‚¬ìš© -> ë ˆì´ì•„ì›ƒ ë°€ë¦¼ í•´ê²° */
            box-shadow: inset 0 0 0 2px #03c75a !important; 
            z-index: 1; 
        }
        
        .day-num { 
            display: block; 
            margin-bottom: 2px; 
            font-weight: bold; 
            color: #333; 
            text-align: left; 
            padding: 5px 0 0 5px; 
        }

        .event-bar { 
            display: block; 
            font-size: 11px; 
            color: white; 
            padding: 3px 6px; 
            white-space: nowrap; 
            overflow: hidden; 
            text-overflow: ellipsis; 
            cursor: pointer; 
            text-align: left; 
            height: 16px; 
            line-height: 16px;
            position: relative;
        }
        
        /* ì‹œì‘ ë¶€ë¶„ */
        .event-bar.is-start { 
            border-top-left-radius: 4px; 
            border-bottom-left-radius: 4px; 
            margin-left: 3px; 
        }
        
        /* ë ë¶€ë¶„ */
        .event-bar.is-end { 
            border-top-right-radius: 4px; 
            border-bottom-right-radius: 4px; 
            margin-right: 3px; 
        }
        
        /* ì¤‘ê°„ ì—°ê²° ë¶€ë¶„ */
        .event-bar:not(.is-start) { margin-left: -1px; padding-left: 8px; } 
        .event-bar:not(.is-end) { margin-right: -1px; padding-right: 8px; }

        .evt-trip { background: #4a90e2; } 
        .evt-vacation { background: #e74c3c; } 
        .evt-etc { background: #f5a623; }
        
        .evt-holiday { 
            background: transparent !important; 
            color: #e74c3c; 
            font-size: 11px; 
            font-weight: bold;
            text-align: left;
            margin-bottom: 2px;
            padding-left: 5px; 
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
            cursor: pointer;
        } 
        
        hr { border: 0; border-top: 1px solid #eee; margin: 25px 0; }
        h3 { margin: 0 0 15px 0; color: #333; font-size: 18px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #555; font-size: 13px; }
        input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 0; font-size: 15px; box-sizing: border-box; appearance: none; }
        
        .type-group { display: flex; gap: 8px; }
        .radio-label { flex: 1; text-align: center; padding: 12px 5px; border: 1px solid #ddd; cursor: pointer; background: #fff; font-size: 13px; white-space: nowrap; }
        .radio-label input { display: none; }
        input[type="radio"]:checked + span { font-weight: bold; }
        
        .radio-label:has(input[value="ì¶œì¥"]:checked) { background: #eaf4ff; border-color: #4a90e2; color: #4a90e2; }
        .radio-label:has(input[value="ì—°ì°¨"]:checked) { background: #ffeeee; border-color: #e74c3c; color: #e74c3c; }
        .radio-label:has(input[value="íœ´ë¬´"]:checked) { background: #fff0f0; border-color: #c0392b; color: #c0392b; }

        .btn-submit { width: 100%; background: #03c75a; color: white; padding: 15px; border: none; border-radius: 0; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        
        details { margin-top: 30px; background: #f8f9fa; padding: 10px; border-radius: 8px; border: 1px solid #eee; }
        summary { font-weight: bold; color: #555; cursor: pointer; outline: none; }
        textarea { width: 100%; height: 150px; margin-top: 10px; font-family: monospace; font-size: 12px; border: 1px solid #ddd; padding: 5px; box-sizing: border-box; }
        .btn-save-config { background: #555; color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; margin-top: 5px; font-size: 13px; }

        .loader { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); z-index: 999; justify-content: center; align-items: center; color: white; font-size: 20px; font-weight: bold; }
    </style>
</head>
<body>

<div id="loader" class="loader">ë°ì´í„° ì²˜ë¦¬ ì¤‘...</div>

<div class="container">
    <div class="calendar-header">
        <button class="btn-month" onclick="changeMonth(-1)">â—€</button>
        <h2 id="monthTitle"></h2>
        <button class="btn-month" onclick="changeMonth(1)">â–¶</button>
    </div>
    
    <div class="calendar-grid" id="calendar"></div>

    <hr>

    <h3>ğŸ“ ì¼ì • ë“±ë¡</h3>
    <div class="form-group">
        <label>ì§ì› ì´ë¦„ (íœ´ë¬´ ë“±ë¡ ì‹œ ë¹„ì›Œë„ ë¨)</label>
        <input type="text" id="name" placeholder="ì´ë¦„ ì…ë ¥">
    </div>

    <div class="form-group">
        <label>êµ¬ë¶„</label>
        <div class="type-group">
            <label class="radio-label"><input type="radio" name="type" value="ì¶œì¥" checked><span>âœˆï¸ ì¶œì¥</span></label>
            <label class="radio-label"><input type="radio" name="type" value="ì—°ì°¨"><span>ğŸ–ï¸ ì—°ì°¨</span></label>
            <label class="radio-label"><input type="radio" name="type" value="ê¸°íƒ€"><span>ğŸ“ ê¸°íƒ€</span></label>
            <label class="radio-label"><input type="radio" name="type" value="íœ´ë¬´"><span>ğŸŒ íœ´ë¬´</span></label>
        </div>
    </div>

    <div class="form-group"><label>ì‹œì‘ì¼</label><input type="date" id="startDate"></div>
    <div class="form-group"><label>ì¢…ë£Œì¼</label><input type="date" id="endDate"></div>
    <div class="form-group"><label>ìƒì„¸ ë‚´ìš© (ëª©ì ì§€ / íœ´ì¼ëª…)</label><input type="text" id="reason" placeholder="ì˜ˆ: ë¶€ì‚° ì¶œì¥ / ì°½ë¦½ê¸°ë…ì¼"></div>

    <button class="btn-submit" onclick="submitData()">ë“±ë¡í•˜ê¸°</button>

    <details>
        <summary>âš™ï¸ ê³µíœ´ì¼ ë°ì´í„° ê´€ë¦¬ (2027ë…„ ê°±ì‹ ìš©)</summary>
        <p style="font-size:12px; color:#666;">ì•„ë˜ ì¹¸ì— ê³µíœ´ì¼ ëª©ë¡(JSON)ì„ ë¶™ì—¬ë„£ê³  ì €ì¥í•˜ì„¸ìš”.</p>
        <textarea id="holidayConfig"></textarea>
        <button class="btn-save-config" onclick="saveHolidayConfig()">ê³µíœ´ì¼ ë°ì´í„° ì €ì¥</button>
    </details>
</div>

<script>
    // â˜…â˜…â˜… [ì¤‘ìš”] ë°°í¬ URL ì…ë ¥ â˜…â˜…â˜…
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxj1RhofZM8Kat7VUk-MZ9oNCgiTMn_Mi3inSWFDy-hbB1oDOCl4IpZGlcNH_gDxylQig/exec";

    const DEFAULT_HOLIDAYS = {
        "2025-01-01": "ì‹ ì •", "2025-01-27": "ëŒ€ì²´íœ´ì¼", "2025-01-28": "ì„¤ë‚ ", "2025-01-29": "ì„¤ë‚  ì—°íœ´", "2025-01-30": "ì„¤ë‚  ì—°íœ´",
        "2025-03-01": "ì‚¼ì¼ì ˆ", "2025-03-03": "ëŒ€ì²´íœ´ì¼", "2025-05-05": "ì–´ë¦°ì´ë‚ ", "2025-05-06": "ëŒ€ì²´íœ´ì¼", "2025-06-06": "í˜„ì¶©ì¼",
        "2025-08-15": "ê´‘ë³µì ˆ", "2025-10-03": "ê°œì²œì ˆ", "2025-10-05": "ì¶”ì„ ì—°íœ´", "2025-10-06": "ì¶”ì„", "2025-10-07": "ì¶”ì„ ì—°íœ´",
        "2025-10-08": "ëŒ€ì²´íœ´ì¼", "2025-10-09": "í•œê¸€ë‚ ", "2025-12-25": "ì„±íƒ„ì ˆ",
        "2026-01-01": "ì‹ ì •", "2026-02-16": "ì„¤ë‚  ì—°íœ´", "2026-02-17": "ì„¤ë‚ ", "2026-02-18": "ì„¤ë‚  ì—°íœ´", "2026-03-01": "ì‚¼ì¼ì ˆ",
        "2026-03-02": "ëŒ€ì²´íœ´ì¼", "2026-05-05": "ì–´ë¦°ì´ë‚ ", "2026-05-24": "ë¶€ì²˜ë‹˜ì˜¤ì‹ ë‚ ", "2026-05-25": "ëŒ€ì²´íœ´ì¼", "2026-06-03": "ì§€ë°©ì„ ê±°",
        "2026-06-06": "í˜„ì¶©ì¼", "2026-08-15": "ê´‘ë³µì ˆ", "2026-08-17": "ëŒ€ì²´íœ´ì¼", "2026-09-24": "ì¶”ì„ ì—°íœ´", "2026-09-25": "ì¶”ì„",
        "2026-09-26": "ì¶”ì„ ì—°íœ´", "2026-10-03": "ê°œì²œì ˆ", "2026-10-09": "í•œê¸€ë‚ ", "2026-12-25": "ì„±íƒ„ì ˆ"
    };

    let HOLIDAYS = DEFAULT_HOLIDAYS; 
    let currentDate = new Date(); 
    let dbEvents = []; 

    window.onload = function() {
        if(SCRIPT_URL.includes("ì—¬ê¸°ì—")) { alert("URL ë¯¸ì„¤ì •"); return; }
        document.getElementById('startDate').valueAsDate = new Date();
        document.getElementById('endDate').valueAsDate = new Date();
        loadEvents(); 
    }

    function showLoader(show) { document.getElementById('loader').style.display = show ? 'flex' : 'none'; }

    function loadEvents() {
        showLoader(true);
        fetch(SCRIPT_URL + "?action=read")
        .then(res => res.json())
        .then(data => {
            dbEvents = data.events;
            if(data.holidays && data.holidays.length > 10) {
                try { HOLIDAYS = JSON.parse(data.holidays); } catch(e) { HOLIDAYS = DEFAULT_HOLIDAYS; }
            }
            document.getElementById('holidayConfig').value = JSON.stringify(HOLIDAYS, null, 4);
            renderCalendar(); 
            showLoader(false);
        })
        .catch(err => { alert("ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨"); showLoader(false); });
    }

    function saveHolidayConfig() {
        const jsonStr = document.getElementById('holidayConfig').value;
        try { JSON.parse(jsonStr); } catch(e) { alert("í˜•ì‹ ì˜¤ë¥˜"); return; }
        if(!confirm("ì—…ë°ì´íŠ¸ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
        showLoader(true);
        fetch(SCRIPT_URL, { method: "POST", mode: "no-cors", body: JSON.stringify({ action: "save_holidays", holidays: jsonStr }) })
        .then(() => { alert("ì €ì¥ë¨"); loadEvents(); })
        .catch(err => { alert("ì˜¤ë¥˜"); showLoader(false); });
    }

    function getWeekNumber(d) {
        d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
        d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay()||7));
        var yearStart = new Date(Date.UTC(d.getUTCFullYear(),0,1));
        return Math.ceil(( ( (d - yearStart) / 86400000) + 1)/7);
    }

    function renderCalendar() {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        
        document.getElementById('monthTitle').innerText = `${year}.${String(month+1).padStart(2,'0')}`;
        const calendarEl = document.getElementById('calendar');
        calendarEl.innerHTML = '';

        calendarEl.innerHTML += `<div class="week-label"></div>`; 
        const days = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '];
        days.forEach((d, idx) => {
            let className = 'header-cell';
            if(idx === 0) className += ' sun'; 
            if(idx === 6) className += ' sat'; 
            calendarEl.innerHTML += `<div class="${className}">${d}</div>`;
        });

        const firstDayObj = new Date(year, month, 1);
        const firstDay = firstDayObj.getDay();
        const lastDate = new Date(year, month + 1, 0).getDate();

        let currentDay = 1;
        let weekCount = 0;
        
        while(currentDay <= lastDate) {
            let weekStartObj = new Date(year, month, currentDay);
            let weekNum = getWeekNumber(weekStartObj);
            
            calendarEl.innerHTML += `<div class="week-label">WK${weekNum}</div>`;

            for(let i=0; i<7; i++) {
                if(weekCount === 0 && i < firstDay) {
                    calendarEl.innerHTML += `<div style="border-bottom:1px solid #eee; border-right:1px solid #eee; background:#fafafa;"></div>`;
                } 
                else if(currentDay <= lastDate) {
                    let isToday = (year === new Date().getFullYear() && month === new Date().getMonth() && currentDay === new Date().getDate()) ? 'today' : '';
                    let thisDayStr = `${year}-${String(month+1).padStart(2,'0')}-${String(currentDay).padStart(2,'0')}`;
                    
                    let holidayName = HOLIDAYS[thisDayStr];
                    let isRedDay = (i === 0 || holidayName) ? true : false;

                    let bgClass = '';
                    if(isRedDay) bgClass = 'holiday-bg';
                    else if(i === 6) bgClass = 'sat'; 

                    dbEvents.forEach(evt => {
                         if(evt.type === 'íœ´ë¬´' && thisDayStr >= evt.start && thisDayStr <= evt.end) {
                             bgClass = 'holiday-bg';
                             isRedDay = true;
                         }
                    });

                    let cellHtml = `<div class="day-cell ${bgClass} ${isToday}">`;
                    
                    let numColor = '';
                    if(isRedDay) numColor = 'style="color:#e74c3c"';
                    else if(i === 6) numColor = 'style="color:#2980b9"';

                    cellHtml += `<span class="day-num" ${numColor}>${currentDay}</span>`;
                    
                    if(holidayName) {
                        cellHtml += `<div class="evt-holiday">${holidayName}</div>`;
                    }

                    // ì¼ì • ì •ë ¬
                    let todaysEvents = dbEvents.filter(evt => thisDayStr >= evt.start && thisDayStr <= evt.end);
                    todaysEvents.sort((a,b) => a.id.localeCompare(b.id));

                    todaysEvents.forEach(evt => {
                        if(evt.type === 'íœ´ë¬´') {
                            cellHtml += `<div class="evt-holiday" onclick="askDelete('${evt.id}', '${evt.reason}', '${evt.type}')">${evt.reason}</div>`;
                        } else {
                            let colorClass = evt.type === 'ì¶œì¥' ? 'evt-trip' : (evt.type === 'ì—°ì°¨' ? 'evt-vacation' : 'evt-etc');
                            let displayText = evt.name;
                            if (evt.type === 'ì—°ì°¨') displayText += " - ì—°ì°¨";
                            else if(evt.reason) displayText += " - " + evt.reason;

                            // â˜…â˜…â˜… [í•µì‹¬] ê¸€ì”¨ í‘œì‹œ ë¡œì§ ìˆ˜ì • â˜…â˜…â˜…
                            // 1. ì¼ì •ì˜ ì²«ë‚ ì´ê±°ë‚˜
                            // 2. ì¼ìš”ì¼(ìƒˆë¡œìš´ ì£¼ ì‹œì‘)ì´ë©´ ê¸€ì”¨ í‘œì‹œ
                            let isStart = (thisDayStr === evt.start);
                            let isWeekStart = (i === 0);
                            let showText = isStart || isWeekStart;

                            let content = showText ? displayText : "&nbsp;"; // ê¸€ì”¨ê°€ ì—†ì–´ë„ ë†’ì´ ìœ ì§€ë¥¼ ìœ„í•´ ê³µë°±

                            let barClass = "";
                            if(isStart) barClass += " is-start";
                            if(thisDayStr === evt.end) barClass += " is-end";

                            cellHtml += `<span class="event-bar ${colorClass} ${barClass}" onclick="askDelete('${evt.id}', '${evt.name}', '${evt.type}')">${content}</span>`;
                        }
                    });

                    cellHtml += `</div>`;
                    calendarEl.innerHTML += cellHtml;
                    currentDay++;
                } 
                else {
                    calendarEl.innerHTML += `<div style="border-bottom:1px solid #eee; border-right:1px solid #eee; background:#fafafa;"></div>`;
                }
            }
            weekCount++;
        }
    }

    function changeMonth(delta) {
        currentDate.setMonth(currentDate.getMonth() + delta);
        renderCalendar();
    }

    function askDelete(id, name, type) {
        if(!id || id.startsWith('manual_') === false) return; 
        if(confirm(`[${type}] ${name} ì¼ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
            showLoader(true);
            fetch(SCRIPT_URL, { method: "POST", mode: "no-cors", body: JSON.stringify({ action: "delete", id: id }) })
            .then(() => { alert("ğŸ—‘ï¸ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤."); setTimeout(loadEvents, 1000); })
            .catch(err => { alert("ì˜¤ë¥˜"); showLoader(false); });
        }
    }

    function submitData() {
        const name = document.getElementById('name').value;
        const type = document.querySelector('input[name="type"]:checked').value;
        const startDate = document.getElementById('startDate').value;
        const endDate = document.getElementById('endDate').value;
        const reason = document.getElementById('reason').value;

        if(type !== 'íœ´ë¬´' && !name) { alert("ì´ë¦„ ì…ë ¥ í•„ìš”"); return; }
        if(!startDate || !endDate) { alert("ë‚ ì§œ ì…ë ¥ í•„ìš”"); return; }
        if(!reason) { alert("ë‚´ìš© ì…ë ¥ í•„ìš”"); return; }

        showLoader(true);
        const data = { name, type, startDate, endDate, reason };
        fetch(SCRIPT_URL, { method: "POST", mode: "no-cors", body: JSON.stringify(data) })
        .then(() => { alert("âœ… ë“±ë¡ë¨"); document.getElementById('name').value=''; document.getElementById('reason').value=''; loadEvents(); })
        .catch(err => { alert("ì˜¤ë¥˜"); showLoader(false); });
    }
</script>

</body>
</html>